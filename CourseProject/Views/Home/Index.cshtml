@using System.IO
@model IEnumerable<Car>
@{
    ViewData["Title"] = "Home Page";
}

<div class="text-center">
    <h1 class="display-4">Welcome</h1>
    <p>Learn about <a href="https://docs.microsoft.com/aspnet/core">building Web apps with ASP.NET Core</a>.</p>
</div>

<form asp-action="Index" method="get">
    <select asp-items="ViewBag.Brands" name="brandId" id="brands-list">
        <option value=""></option>
    </select>
    <br>
    <select name="modelId" id="models-list"></select>
    <br>
    Fuel type:
    @foreach (var fuelType in ViewBag.FuelTypes) {
        <label for="@fuelType.Name-checkbox">@fuelType.Name</label>

        <input id="@fuelType.Name-checkbox" type="checkbox" value="@fuelType.Id" name="fuelTypes">

    }
    <br>
    Body type:
    @foreach (var bodyType in ViewBag.BodyTypes) {
        <label for="@bodyType.Name-checkbox">@bodyType.Name</label>
        <input id="@bodyType.Name-checkbox" type="checkbox" value="@bodyType.Id" name="bodyTypes">

    }
    <br>
    Transmission type:
    @foreach (var transmissionType in ViewBag.TransmissionTypes) {
        <label for="@transmissionType.Name-checkbox">@transmissionType.Name</label>
        <input id="@transmissionType.Name-checkbox" type="checkbox" value="@transmissionType.Id" name="transmissionTypes">
    }
    <br>
    <input type="submit" value="Search" />
</form>
<br><br>

    <table class="table">
        <thead>
            <tr>
                <th>
                    @Html.DisplayNameFor(model => model.Year)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Price)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.State)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Model)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.EngineVolume)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.Mileage)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.FuelType)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.BodyType)
                </th>
                <th>
                    @Html.DisplayNameFor(model => model.TransmissionType)
                </th>
                @*<th>Image</th>
                <th></th>*@
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model) {
                <tr>
                    <td>
                        @Html.DisplayFor(modelItem => item.Year)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Price)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.State)
                    </td>
                    <td>
                        @*@Html.DisplayFor(modelItem => item.Model.Name)*@
                        @item.Model.Brand.Name @item.Model.Parent?.Name @item.Model.Name
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.EngineVolume)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.Mileage)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.FuelType.Name)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.BodyType.Name)
                    </td>
                    <td>
                        @Html.DisplayFor(modelItem => item.TransmissionType.Name)
                    </td>
                    @*<td>
                        @if (Directory.Exists(ViewBag.ImagesDirectory + $"{item.Id}")) {

                            var files = new DirectoryInfo(ViewBag.ImagesDirectory + $"{item.Id}").GetFiles();

                            if (files.Length > 0) {

                                <img src="/img/cars/@item.Id/@files[0].Name" alt="" style="width: 100px">
                            }

                        }
                    </td>*@
                    @*<td>
                        <a asp-action="Edit" asp-route-id="@item.Id">Edit</a> |
                        <a asp-action="Details" asp-route-id="@item.Id">Details</a> |
                        <a asp-action="Delete" asp-route-id="@item.Id">Delete</a>
                    </td>*@
                </tr>
            }
        </tbody>
    </table>


@section Scripts {
    <script type="text/javascript">
        $(document).ready(() => {
            $('#brands-list').on('click', 'option', (e) => {
                console.log(e.target.value);
                let brandId = encodeURIComponent(e.target.value);
                $('#models-list').load('@Url.Action("GetModelsByBrand", "Home")?brandId='+brandId);
            });
        });
    </script>
}